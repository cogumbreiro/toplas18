---
layout: default
---
<pre class="code"><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Structures.OrderedType.html#"><span class="id" title="library">Coq.Structures.OrderedType</span></a>.<br/><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.FSets.FMapAVL.html#"><span class="id" title="library">Coq.FSets.FMapAVL</span></a>.<br/><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Structures.OrderedTypeEx.html#"><span class="id" title="library">Coq.Structures.OrderedTypeEx</span></a>.<br/><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Brenner.Vars.html#"><span class="id" title="library">Vars</span></a>.<br/><span class="id" title="keyword">Import</span> <span class="id" title="var">Map_TID</span>.<br/></pre>
<a name="lab1"><h1>Phaser</h1></a><p>A phaser is a map from tasks to phase numbers.</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="phaser"><span class="id" title="definition">phaser</span></a> := <a class="idref" href="Brenner.Vars.html#Map_TID.t"><span class="id" title="definition">t</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>.<br/></pre>
<p>Operation advance increments the phase of the given task.</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="advance"><span class="id" title="definition">advance</span></a> (<span class="id" title="var">ph</span>:<a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) : <a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a> :=<br/>  <span class="id" title="keyword">match</span> <a class="idref" href="Brenner.Vars.html#Map_TID.find"><span class="id" title="definition">find</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a> <span class="id" title="keyword">with</span><br/>    | <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">n</span> =&gt; <a class="idref" href="Brenner.Vars.html#Map_TID.add"><span class="id" title="definition">Map_TID.add</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> (<span class="id" title="var">n</span> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Peano.html#b3eea360671e1b32b18a26e15b3aace3"><span class="id" title="notation">+</span></a> 1) <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a><br/>    | <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a><br/>  <span class="id" title="keyword">end</span>.<br/></pre>
<p>Operation await holds when every member of the phaser has
    reached at least phase <span class="inlinecode"><span class="id" title="var">n</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="await"><span class="id" title="definition">await</span></a> (<span class="id" title="var">ph</span>:<a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>) (<span class="id" title="var">n</span>:<a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span> <span class="id" title="var">n'</span>,<br/>  <a class="idref" href="Brenner.Vars.html#Map_TID.MapsTo"><span class="id" title="definition">MapsTo</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Brenner.Phaser.html#n'"><span class="id" title="variable">n'</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">-&gt;</span></a><br/>  <a class="idref" href="Brenner.Phaser.html#n'"><span class="id" title="variable">n'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Peano.html#9b077c369e19739ef880736ba34623ff"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="Brenner.Phaser.html#n"><span class="id" title="variable">n</span></a>.<br/></pre>
<p>Operation <span class="inlinecode"><span class="id" title="var">register</span></span> assigns a new member in the phaser.</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="register"><span class="id" title="definition">register</span></a> (<span class="id" title="var">ph</span>:<a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) (<span class="id" title="var">n</span>:<a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a> :=<br/>  <a class="idref" href="Brenner.Vars.html#Map_TID.add"><span class="id" title="definition">add</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Brenner.Phaser.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a>.<br/></pre>
<p>Operation <span class="inlinecode"><span class="id" title="var">deregister</span></span> revokes the membership of a task in the phaser.</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="deregister"><span class="id" title="definition">deregister</span></a> (<span class="id" title="var">ph</span>:<a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) : <a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a> :=<br/>  <a class="idref" href="Brenner.Vars.html#Map_TID.remove"><span class="id" title="definition">remove</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a>.<br/></pre>
<p>Operation <span class="inlinecode"><span class="id" title="var">phase</span></span> looks up the phase associated with a given task,
    or yields <span class="inlinecode"><span class="id" title="var">None</span></span> if the given task  is unregistered.</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="phase"><span class="id" title="definition">phase</span></a> (<span class="id" title="var">ph</span>:<a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> :=<br/>  <a class="idref" href="Brenner.Vars.html#Map_TID.find"><span class="id" title="definition">find</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a>.<br/></pre>
<p>Creates a phaser with a given task initialized at phase <span class="inlinecode">0</span> .</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="make"><span class="id" title="definition">make</span></a> (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) : <a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a> :=<br/>  <a class="idref" href="Brenner.Vars.html#Map_TID.add"><span class="id" title="definition">add</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> 0 (<a class="idref" href="Brenner.Vars.html#Map_TID.empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>).<br/></pre>
<p>Defines the API of a phaser.</p>
<pre class="code"><span class="id" title="keyword">Inductive</span> <a name="op"><span class="id" title="inductive">op</span></a> :=<br/>  | <a name="ADV"><span class="id" title="constructor">ADV</span></a> : <a class="idref" href="Brenner.Phaser.html#op"><span class="id" title="inductive">op</span></a><br/>  | <a name="REG"><span class="id" title="constructor">REG</span></a> : <a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Brenner.Phaser.html#op"><span class="id" title="inductive">op</span></a><br/>  | <a name="DEREG"><span class="id" title="constructor">DEREG</span></a> : <a class="idref" href="Brenner.Phaser.html#op"><span class="id" title="inductive">op</span></a>.<br/></pre>
<p>Applies a phaser operation according to the tag.</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="eval"><span class="id" title="definition">eval</span></a> (<span class="id" title="var">ph</span>:<a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) (<span class="id" title="var">o</span>:<a class="idref" href="Brenner.Phaser.html#op"><span class="id" title="inductive">op</span></a>) : <a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a> :=<br/>  <span class="id" title="keyword">match</span> <a class="idref" href="Brenner.Phaser.html#o"><span class="id" title="variable">o</span></a> <span class="id" title="keyword">with</span><br/>    | <a class="idref" href="Brenner.Phaser.html#ADV"><span class="id" title="constructor">ADV</span></a> =&gt; <a class="idref" href="Brenner.Phaser.html#advance"><span class="id" title="definition">advance</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a><br/>    | <a class="idref" href="Brenner.Phaser.html#REG"><span class="id" title="constructor">REG</span></a> <span class="id" title="var">t'</span> =&gt;<br/>      <span class="id" title="keyword">match</span> <a class="idref" href="Brenner.Phaser.html#phase"><span class="id" title="definition">phase</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>        | <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">n</span> =&gt; <a class="idref" href="Brenner.Phaser.html#register"><span class="id" title="definition">register</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a> <span class="id" title="var">t'</span> <span class="id" title="var">n</span><br/>        | <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a><br/>      <span class="id" title="keyword">end</span><br/>    | <a class="idref" href="Brenner.Phaser.html#DEREG"><span class="id" title="constructor">DEREG</span></a> =&gt; <a class="idref" href="Brenner.Phaser.html#deregister"><span class="id" title="definition">deregister</span></a> <a class="idref" href="Brenner.Phaser.html#ph"><span class="id" title="variable">ph</span></a> <a class="idref" href="Brenner.Phaser.html#t"><span class="id" title="variable">t</span></a><br/>  <span class="id" title="keyword">end</span>.<br/></pre>
