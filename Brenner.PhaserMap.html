---
layout: default
---
<pre class="code"><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Structures.OrderedType.html#"><span class="id" title="library">Coq.Structures.OrderedType</span></a>.<br/><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.FSets.FMapAVL.html#"><span class="id" title="library">Coq.FSets.FMapAVL</span></a>.<br/><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Structures.OrderedTypeEx.html#"><span class="id" title="library">Coq.Structures.OrderedTypeEx</span></a>.<br/><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Brenner.Phaser.html#"><span class="id" title="library">Phaser</span></a>.<br/><span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Brenner.Vars.html#"><span class="id" title="library">Vars</span></a>.<br/></pre>
<a name="lab2"><h1>Phaser map</h1></a><p>A phaser map is a map from phaser identifier to a <span class="inlinecode"><span class="id" title="var">phaser</span></span> state.</p>
<pre class="code"><span class="id" title="keyword">Import</span> <span class="id" title="var">Map_PHID</span>.<br/><span class="id" title="keyword">Definition</span> <a name="phasermap"><span class="id" title="definition">phasermap</span></a> := <a class="idref" href="Brenner.Vars.html#Map_PHID.t"><span class="id" title="definition">t</span></a> <a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>.<br/></pre>
<p>Function <span class="inlinecode"><span class="id" title="var">make</span></span> creates an empty phasermap.</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="make"><span class="id" title="definition">make</span></a> := <a class="idref" href="Brenner.Vars.html#Map_PHID.empty"><span class="id" title="definition">empty</span></a> <a class="idref" href="Brenner.Phaser.html#phaser"><span class="id" title="definition">phaser</span></a>.<br/></pre>
<p>Function <span class="inlinecode"><span class="id" title="var">newPhaser</span></span>  <span class="inlinecode"><span class="id" title="var">pm</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode"><span class="id" title="var">p</span></span> expects a phaser map <span class="inlinecode"><span class="id" title="var">pm</span></span> a task identifier <span class="inlinecode"><span class="id" title="var">t</span></span> and a phaser identifier <span class="inlinecode"><span class="id" title="var">p</span></span> and assigns a new phaser state to identifier <span class="inlinecode"><span class="id" title="var">p</span></span> ;
  the phaser state is registered with task <span class="inlinecode"><span class="id" title="var">t</span></span> , as per <span class="inlinecode"><span class="id" title="var">Phaser.make</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="newPhaser"><span class="id" title="definition">newPhaser</span></a> (<span class="id" title="var">pm</span>:<a class="idref" href="Brenner.PhaserMap.html#phasermap"><span class="id" title="definition">phasermap</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) (<span class="id" title="var">p</span>:<a class="idref" href="Brenner.Vars.html#phid"><span class="id" title="definition">phid</span></a>) : <a class="idref" href="Brenner.PhaserMap.html#phasermap"><span class="id" title="definition">phasermap</span></a> :=<br/>  <a class="idref" href="Brenner.Vars.html#Map_PHID.add"><span class="id" title="definition">add</span></a> <a class="idref" href="Brenner.PhaserMap.html#p"><span class="id" title="variable">p</span></a> (<a class="idref" href="Brenner.Phaser.html#make"><span class="id" title="definition">Phaser.make</span></a> <a class="idref" href="Brenner.PhaserMap.html#t"><span class="id" title="variable">t</span></a>) <a class="idref" href="Brenner.PhaserMap.html#pm"><span class="id" title="variable">pm</span></a>.<br/></pre>
<p>Thus, there are two possible operations, either we create a phaser
  with <span class="inlinecode"><span class="id" title="var">NEW</span></span> or we invoke a phaser operation with <span class="inlinecode"><span class="id" title="var">APP</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Inductive</span> <a name="op"><span class="id" title="inductive">op</span></a> :=<br/>  | <a name="NEW"><span class="id" title="constructor">NEW</span></a> : <a class="idref" href="Brenner.Vars.html#phid"><span class="id" title="definition">phid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Brenner.PhaserMap.html#op"><span class="id" title="inductive">op</span></a><br/>  | <a name="APP"><span class="id" title="constructor">APP</span></a> : <a class="idref" href="Brenner.Vars.html#phid"><span class="id" title="definition">phid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Brenner.Phaser.html#op"><span class="id" title="inductive">Phaser.op</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="Brenner.PhaserMap.html#op"><span class="id" title="inductive">op</span></a>.<br/></pre>
<p>Function <span class="inlinecode"><span class="id" title="var">ph_apply</span></span>  <span class="inlinecode"><span class="id" title="var">pm</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode"><span class="id" title="var">p</span></span>  <span class="inlinecode"><span class="id" title="var">o</span></span> looks up the phaser associated with
identifier <span class="inlinecode"><span class="id" title="var">p</span></span> and applies a phaser operation <span class="inlinecode"><span class="id" title="var">o</span></span> to that phaser, prefixed
with task <span class="inlinecode"><span class="id" title="var">t</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="ph_apply"><span class="id" title="definition">ph_apply</span></a> (<span class="id" title="var">pm</span>:<a class="idref" href="Brenner.PhaserMap.html#phasermap"><span class="id" title="definition">phasermap</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) (<span class="id" title="var">p</span>:<a class="idref" href="Brenner.Vars.html#phid"><span class="id" title="definition">phid</span></a>) (<span class="id" title="var">o</span>:<a class="idref" href="Brenner.Phaser.html#op"><span class="id" title="inductive">Phaser.op</span></a>) : <a class="idref" href="Brenner.PhaserMap.html#phasermap"><span class="id" title="definition">phasermap</span></a> :=<br/>  <span class="id" title="keyword">match</span> <a class="idref" href="Brenner.Vars.html#Map_PHID.find"><span class="id" title="definition">find</span></a> <a class="idref" href="Brenner.PhaserMap.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="Brenner.PhaserMap.html#pm"><span class="id" title="variable">pm</span></a> <span class="id" title="keyword">with</span><br/>    | <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">ph</span> =&gt; <a class="idref" href="Brenner.Vars.html#Map_PHID.add"><span class="id" title="definition">add</span></a> <a class="idref" href="Brenner.PhaserMap.html#p"><span class="id" title="variable">p</span></a> (<a class="idref" href="Brenner.Phaser.html#eval"><span class="id" title="definition">Phaser.eval</span></a> <span class="id" title="var">ph</span> <a class="idref" href="Brenner.PhaserMap.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Brenner.PhaserMap.html#o"><span class="id" title="variable">o</span></a>) <a class="idref" href="Brenner.PhaserMap.html#pm"><span class="id" title="variable">pm</span></a><br/>    | <a class="idref" href="http://coq.inria.fr/distrib/8.7.1/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="Brenner.PhaserMap.html#pm"><span class="id" title="variable">pm</span></a><br/>  <span class="id" title="keyword">end</span>.<br/></pre>
<p>The semantics can be summarized with operation <span class="inlinecode"><span class="id" title="tactic">eval</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Definition</span> <a name="eval"><span class="id" title="definition">eval</span></a> (<span class="id" title="var">pm</span>:<a class="idref" href="Brenner.PhaserMap.html#phasermap"><span class="id" title="definition">phasermap</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Brenner.Vars.html#tid"><span class="id" title="definition">tid</span></a>) (<span class="id" title="var">o</span>:<a class="idref" href="Brenner.PhaserMap.html#op"><span class="id" title="inductive">op</span></a>) : <a class="idref" href="Brenner.PhaserMap.html#phasermap"><span class="id" title="definition">phasermap</span></a> :=<br/>  <span class="id" title="keyword">match</span> <a class="idref" href="Brenner.PhaserMap.html#o"><span class="id" title="variable">o</span></a> <span class="id" title="keyword">with</span><br/>    | <a class="idref" href="Brenner.PhaserMap.html#NEW"><span class="id" title="constructor">NEW</span></a> <span class="id" title="var">p</span> =&gt; <a class="idref" href="Brenner.PhaserMap.html#newPhaser"><span class="id" title="definition">newPhaser</span></a> <a class="idref" href="Brenner.PhaserMap.html#pm"><span class="id" title="variable">pm</span></a> <a class="idref" href="Brenner.PhaserMap.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="var">p</span><br/>    | <a class="idref" href="Brenner.PhaserMap.html#APP"><span class="id" title="constructor">APP</span></a> <span class="id" title="var">p</span> <span class="id" title="var">o'</span> =&gt; <a class="idref" href="Brenner.PhaserMap.html#ph_apply"><span class="id" title="definition">ph_apply</span></a> <a class="idref" href="Brenner.PhaserMap.html#pm"><span class="id" title="variable">pm</span></a> <a class="idref" href="Brenner.PhaserMap.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="var">p</span> <span class="id" title="var">o'</span><br/>  <span class="id" title="keyword">end</span>.<br/></pre>
