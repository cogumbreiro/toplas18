---
layout: default
---

<a name="lab7"><h1>Soudness</h1></a>
<p>The property of soundness ensures the absense of false positives,
  that is, soundness entails that if we find a cycle in the WFG of 
  a given state, then such state is deadlocked.
  The proof follows by first showing soundness on totally deadlocked states.</p><a name="lab8"><h2>Soundness for totally deadlocked states</h2></a>
<pre class="code"><span class="id" title="keyword">Section</span> <span class="id" title="var">Basic</span>.<br/></pre>
<p>Let <span class="inlinecode"><span class="id" title="var">s</span></span> be a state.</p>
<pre class="code">  <span class="id" title="keyword">Variable</span> <span class="id" title="var">s</span>:<span class="id" title="var">state</span>.<br/><span class="id" title="keyword">Section</span> <span class="id" title="var">TotallyDeadlocked</span>.<br/></pre>
<p>Let <span class="inlinecode"><span class="id" title="var">w</span></span> be a cycle <span class="inlinecode"><span class="id" title="var">w</span></span> in the WFG of <span class="inlinecode"><span class="id" title="var">s</span></span> such that
 the vertices in <span class="inlinecode"><span class="id" title="var">w</span></span> constitute the domain of the task map of <span class="inlinecode"><span class="id" title="var">s</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Variable</span> <span class="id" title="var">w</span>:<span class="id" title="var">t_walk</span>.<br/><span class="id" title="keyword">Variable</span> <span class="id" title="var">is_cycle</span>: <span class="id" title="var">TCycle</span> <span class="id" title="var">s</span> <span class="id" title="var">w</span>.<br/><span class="id" title="keyword">Variable</span> <span class="id" title="var">vertex_in_tasks</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span>, <span class="id" title="var">Graph.In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> &lt;-&gt; <span class="id" title="var">Map_TID.In</span> <span class="id" title="var">t</span> (<span class="id" title="var">get_tasks</span> <span class="id" title="var">s</span>).<br/><span class="id" title="keyword">Theorem</span> <span class="id" title="var">soundness_totally</span>:<br/>  <span class="id" title="var">TotallyDeadlocked</span> <span class="id" title="var">s</span>.<br/></pre>
<p>Recall that:</p><pre>
TotallyDeadlocked s = 
  AllTasksWaitOn s /\
  AllImpededBy s /\
  (exists t, Map_TID.In t (get_tasks s))
     : Prop
</pre><p>First, let us show that <span class="inlinecode"><span class="id" title="var">AllTasksWaitOn</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> holds.
   By unfolding this definition we get that:<code>
H : Map_TID.In (elt:=prog) t (get_tasks s)
______________________________________(1/1)
exists e : event, WaitOn s t e
</code>We can conclude that <span class="inlinecode"><span class="id" title="var">Graph.In</span></span>  <span class="inlinecode">(<span class="id" title="var">F.Edge</span></span>  <span class="inlinecode"><span class="id" title="var">w</span>)</span>  <span class="inlinecode"><span class="id" title="var">t</span></span> holds by applying
   hypothesis <span class="inlinecode"><span class="id" title="var">vertex_in_tasks</span></span> .
   Now, since <span class="inlinecode"><span class="id" title="var">t</span></span> is in cycle <span class="inlinecode"><span class="id" title="var">w</span></span> , then there must exist some other task <span class="inlinecode"><span class="id" title="var">t'</span></span> such
   that succeeds <span class="inlinecode"><span class="id" title="var">t</span></span> in cycle <span class="inlinecode"><span class="id" title="var">w</span></span> , say <span class="inlinecode">(<span class="id" title="var">TEdge</span></span>  <span class="inlinecode"><span class="id" title="var">s</span>)</span>  <span class="inlinecode">(<span class="id" title="var">t</span>,</span>  <span class="inlinecode"><span class="id" title="var">t2</span>)</span> .
   We conclude this case by unfolding <span class="inlinecode"><span class="id" title="var">TEdge</span></span> .</p><p>Second, we show <span class="inlinecode"><span class="id" title="var">AllImpededBy</span></span> . By unfolding our goal, we get that:</p><pre>
H : WaitOn s t e
______________________________________(1/1)
exists t' : tid, ImpededBy s e t'
</pre><p>From <span class="inlinecode"><span class="id" title="var">WaitOn</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode"><span class="id" title="var">e</span></span> we know that <span class="inlinecode"><span class="id" title="var">t</span></span> in <span class="inlinecode"><span class="id" title="var">get_tasks</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> ,
  hence <span class="inlinecode"><span class="id" title="var">In</span></span>  <span class="inlinecode">(<span class="id" title="var">F.Edge</span></span>  <span class="inlinecode"><span class="id" title="var">w</span>)</span>  <span class="inlinecode"><span class="id" title="var">t</span></span> .
  Since <span class="inlinecode"><span class="id" title="var">w</span></span> is a cycle, there is some <span class="inlinecode"><span class="id" title="var">t'</span></span> such that <span class="inlinecode">(<span class="id" title="var">TEdge</span></span>  <span class="inlinecode"><span class="id" title="var">s</span>)</span>  <span class="inlinecode">(<span class="id" title="var">t</span>,</span>  <span class="inlinecode"><span class="id" title="var">t'</span>)</span> .
  By inversting the latter we get that there exists some event <span class="inlinecode"><span class="id" title="var">e'</span></span> such that <span class="inlinecode"><span class="id" title="var">WaitOn</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode"><span class="id" title="var">e'</span></span> and <span class="inlinecode"><span class="id" title="var">ImpededBy</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span>  <span class="inlinecode"><span class="id" title="var">e</span></span>  <span class="inlinecode"><span class="id" title="var">t'</span></span> .
  However, we know that each task can only wait on one event, thus <span class="inlinecode"><span class="id" title="var">e</span></span>  <span class="inlinecode">=</span>  <span class="inlinecode"><span class="id" title="var">e'</span></span> .</p><p>Third, we show that there exists some task <span class="inlinecode"><span class="id" title="var">t</span></span> such that <span class="inlinecode"><span class="id" title="var">Map_TID.In</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode">(<span class="id" title="var">get_tasks</span></span>  <span class="inlinecode"><span class="id" title="var">s</span>))</span> .
 Since <span class="inlinecode"><span class="id" title="var">w</span></span> is a cycle, then, by
   definition, there is at least one vertex <span class="inlinecode"><span class="id" title="var">t</span></span> such that <span class="inlinecode"><span class="id" title="var">w</span></span> starts with <span class="inlinecode"><span class="id" title="var">t</span></span> and <span class="inlinecode"><span class="id" title="var">w</span></span> ends with <span class="inlinecode"><span class="id" title="var">t</span></span> .
   Since <span class="inlinecode"><span class="id" title="var">w</span></span> starts with <span class="inlinecode"><span class="id" title="var">t</span></span> , then there is some task <span class="inlinecode"><span class="id" title="var">t'</span></span> and a walk <span class="inlinecode"><span class="id" title="var">w'</span></span> such that <span class="inlinecode"><span class="id" title="var">w</span></span>  <span class="inlinecode">=</span>  <span class="inlinecode">(<span class="id" title="var">t</span>,</span>  <span class="inlinecode"><span class="id" title="var">t2</span>)</span>  <span class="inlinecode">::</span>  <span class="inlinecode"><span class="id" title="var">w'</span></span> , hence <span class="inlinecode"><span class="id" title="var">List.In</span></span>  <span class="inlinecode">(<span class="id" title="var">t</span>,</span>  <span class="inlinecode"><span class="id" title="var">t2</span>)</span>  <span class="inlinecode"><span class="id" title="var">w</span></span> .
   We conclude by applying <span class="inlinecode"><span class="id" title="var">vertex_in_tasks</span></span> to the latter.</p>
<pre class="code"><span class="id" title="keyword">End</span> <span class="id" title="var">TotallyDeadlocked</span>.<br/><span class="id" title="keyword">End</span> <span class="id" title="var">Basic</span>.<br/></pre>
<a name="lab9"><h2>Soundness for deadlocked  states</h2></a>
<pre class="code"><span class="id" title="keyword">Section</span> <span class="id" title="var">Soundness</span>.<br/><span class="id" title="keyword">Variable</span> <span class="id" title="var">w</span>: <span class="id" title="var">t_walk</span>.<br/><span class="id" title="keyword">Variable</span> <span class="id" title="var">s</span>: <span class="id" title="var">state</span>.<br/><span class="id" title="keyword">Variable</span> <span class="id" title="var">is_cycle</span>: <span class="id" title="var">TCycle</span> <span class="id" title="var">s</span> <span class="id" title="var">w</span>.<br/></pre>
<p>Our goal is to show that <span class="inlinecode"><span class="id" title="var">s</span></span> is deadlocked.
    By unfolding <span class="inlinecode"><span class="id" title="var">Deadlocked</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> we get<code>
______________________________________(1/1)
exists tm tm' : Map_TID.t prog,
  Map_TID_Props.Partition (get_tasks s) tm tm' /\
  TotallyDeadlocked (get_phasers s, tm)    
</code>That is, we need to find a partition of the task map <span class="inlinecode"><span class="id" title="var">tm</span></span> that is totally
deadlocked. To find such a partition we use</p><pre>
Map_TID_Props.partition
     : forall elt : Type,
       (Map_TID.key -&gt; elt -&gt; bool) -&gt;
       Map_TID.t elt -&gt; Map_TID.t elt * Map_TID.t elt
</pre><p>which takes a selector function of type <span class="inlinecode"><span class="id" title="var">Map_TID.key</span></span>  <span class="inlinecode">-&gt;</span>  <span class="inlinecode"><span class="id" title="var">elt</span></span>  <span class="inlinecode">-&gt;</span>  <span class="inlinecode"><span class="id" title="var">bool</span></span> and
a task map, and then yields two partitions, on the left side
are the elements which the selector returned <span class="inlinecode"><span class="id" title="var">true</span></span> and
on the right side are the which the selector returned <span class="inlinecode"><span class="id" title="var">false</span></span> .</p><p>We want to partition <span class="inlinecode"><span class="id" title="var">get_tasks</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> according to the members of the walk <span class="inlinecode"><span class="id" title="var">w</span></span> ,
since in a totally deadlocked state all the members of the task
map are in the cycle and vice versa.</p><p>Let <span class="inlinecode"><span class="id" title="var">part</span></span> and <span class="inlinecode"><span class="id" title="tactic">split</span></span> be defined as</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="tactic">split</span> : <span class="id" title="var">tid</span> -&gt; <span class="id" title="var">prog</span> -&gt; <span class="id" title="var">bool</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> (<span class="id" title="var">p</span>:<span class="id" title="var">prog</span>) =&gt; <span class="id" title="var">F.mem</span> <span class="id" title="var">TID.eq_dec</span> <span class="id" title="var">t</span> <span class="id" title="var">w</span>).<br/><span class="id" title="keyword">Let</span> <span class="id" title="var">part</span> := <span class="id" title="var">Map_TID_Props.partition</span> <span class="id" title="tactic">split</span> (<span class="id" title="var">get_tasks</span> <span class="id" title="var">s</span>).<br/></pre>
<p>where <span class="inlinecode"><span class="id" title="var">F.mem</span></span> is testing the node membership in walk <span class="inlinecode"><span class="id" title="var">w</span></span> . The result
of <span class="inlinecode"><span class="id" title="var">part</span></span> is two task maps. On the left-hand side, we have 
the task map <span class="inlinecode"><span class="id" title="var">fst</span></span>  <span class="inlinecode"><span class="id" title="var">part</span></span> such that <span class="inlinecode"><span class="id" title="var">t</span></span> is in the domain of <span class="inlinecode"><span class="id" title="var">dst</span></span>  <span class="inlinecode"><span class="id" title="var">part</span></span> if, and only if <span class="inlinecode"><span class="id" title="var">t</span></span> is a member of walk <span class="inlinecode"><span class="id" title="var">w</span></span> .</p><p>Function <span class="inlinecode"><span class="id" title="tactic">split</span></span> returns <span class="inlinecode"><span class="id" title="var">true</span></span> if, and only if, the vertex
    is in cycle <span class="inlinecode"><span class="id" title="var">w</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">split_to_vertex</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span> <span class="id" title="var">e</span>,<br/>  <span class="id" title="tactic">split</span> <span class="id" title="var">t</span> <span class="id" title="var">e</span> = <span class="id" title="var">true</span> -&gt;<br/>  <span class="id" title="var">In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span>.<br/><span class="id" title="keyword">Let</span> <span class="id" title="var">vertex_to_split</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span> <span class="id" title="var">p</span>,<br/>  <span class="id" title="var">In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> -&gt;<br/>  <span class="id" title="tactic">split</span> <span class="id" title="var">t</span> <span class="id" title="var">p</span> = <span class="id" title="var">true</span>.<br/></pre>
<p>Apply <span class="inlinecode"><span class="id" title="var">Map_TID_Props.partition_Partition</span></span> shows that <span class="inlinecode"><span class="id" title="var">part</span></span> is indeed a partition of <span class="inlinecode"><span class="id" title="var">get_tasks</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">Hpart</span>: <span class="id" title="var">Map_TID_Props.Partition</span> (<span class="id" title="var">get_tasks</span> <span class="id" title="var">s</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">part</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">part</span>).<br/></pre>
<p>Let <span class="inlinecode"><span class="id" title="var">ds</span></span> be the state that we want to show to be totally deadlocked.</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">deadlocked_tasks</span> := <span class="id" title="var">fst</span> <span class="id" title="var">part</span>.<br/><span class="id" title="keyword">Let</span> <span class="id" title="var">ds</span> := (<span class="id" title="var">get_phasers</span> <span class="id" title="var">s</span>, <span class="id" title="var">deadlocked_tasks</span>).<br/></pre>
<p>Since our aim is to apply Theorem <span class="inlinecode"><span class="id" title="var">soundness_totally</span></span> to state <span class="inlinecode"><span class="id" title="var">ds</span></span> ,
  then we need to show that
  (i) each task <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">w</span></span> iff t is in state <span class="inlinecode"><span class="id" title="var">ds</span></span> , and
  (ii) cycle <span class="inlinecode"><span class="id" title="var">w</span></span> is in the WFG of <span class="inlinecode"><span class="id" title="var">ds</span></span> .</p><p>If task <span class="inlinecode"><span class="id" title="var">t</span></span> is in state <span class="inlinecode"><span class="id" title="var">ds</span></span> , then task <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">w</span></span> .
  Proof: if task <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">deadlocked_tasks</span></span> , then
  there exists a program <span class="inlinecode"><span class="id" title="var">p</span></span> such that <span class="inlinecode"><span class="id" title="tactic">split</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode"><span class="id" title="var">p</span></span>  <span class="inlinecode">=</span>  <span class="inlinecode"><span class="id" title="var">true</span></span> and <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">get_tasks</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> . Since we have <span class="inlinecode"><span class="id" title="tactic">split</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode"><span class="id" title="var">p</span></span>  <span class="inlinecode">=</span>  <span class="inlinecode"><span class="id" title="var">true</span></span> , then <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">w</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">deadlocked_in_right</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span>,<br/>  <span class="id" title="var">Map_TID.In</span> <span class="id" title="var">t</span> <span class="id" title="var">deadlocked_tasks</span> -&gt; <span class="id" title="var">In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span>.<br/></pre>
<p>If task <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">w</span></span> , then <span class="inlinecode"><span class="id" title="var">t</span></span> is in state <span class="inlinecode"><span class="id" title="var">ds</span></span> .
  Proof: <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">w</span></span> , so there exists a program <span class="inlinecode"><span class="id" title="var">p</span></span> such that <span class="inlinecode"><span class="id" title="var">t</span></span> maps to <span class="inlinecode"><span class="id" title="var">p</span></span> in <span class="inlinecode"><span class="id" title="var">get_tasks</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> . Since <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">w</span></span> , then <span class="inlinecode"><span class="id" title="tactic">split</span></span>  <span class="inlinecode"><span class="id" title="var">t</span></span>  <span class="inlinecode"><span class="id" title="var">p</span></span>  <span class="inlinecode">=</span>  <span class="inlinecode"><span class="id" title="var">true</span></span> , thus <span class="inlinecode"><span class="id" title="var">t</span></span> is in <span class="inlinecode"><span class="id" title="var">deadlocked_tasks</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">deadlocked_in_left</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span>,<br/>  <span class="id" title="var">In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> -&gt; <span class="id" title="var">Map_TID.In</span> <span class="id" title="var">t</span> <span class="id" title="var">deadlocked_tasks</span>.<br/></pre>
<p>Lemma <span class="inlinecode"><span class="id" title="var">vertex_in_tasks</span></span> captures result (i), and is trivially proved by
  applying Lemmas <span class="inlinecode"><span class="id" title="var">deadlocked_in_left</span></span> and <span class="inlinecode"><span class="id" title="var">deadlocked_in_right</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">vertex_in_tasks</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span>, <span class="id" title="var">Graph.In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> &lt;-&gt; <span class="id" title="var">Map_TID.In</span> <span class="id" title="var">t</span> (<span class="id" title="var">get_tasks</span> <span class="id" title="var">ds</span>).<br/><span class="id" title="keyword">Let</span> <span class="id" title="var">deadlocked_in</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span>,<br/>  (<span class="id" title="var">In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> &lt;-&gt; <span class="id" title="var">Map_TID.In</span> <span class="id" title="var">t</span> (<span class="id" title="var">fst</span> <span class="id" title="var">part</span>)).<br/></pre>
<p>Next, we show (ii), by first establishing that if an edge <span class="inlinecode"><span class="id" title="var">e</span></span> is in <span class="inlinecode"><span class="id" title="var">w</span></span> and <span class="inlinecode"><span class="id" title="var">e</span></span> is an ede of the WFG of <span class="inlinecode"><span class="id" title="var">s</span></span> , then <span class="inlinecode"><span class="id" title="var">e</span></span> is an edge of the WFG of <span class="inlinecode"><span class="id" title="var">ds</span></span> .
  Such proof requires the demonstration that any task <span class="inlinecode"><span class="id" title="var">t</span></span> in <span class="inlinecode"><span class="id" title="var">w</span></span> is blocked (registered)
  in <span class="inlinecode"><span class="id" title="var">ds</span></span> , and that any event <span class="inlinecode"><span class="id" title="var">e</span></span> that impedes a task in <span class="inlinecode"><span class="id" title="var">w</span></span> also
  impedes over state <span class="inlinecode"><span class="id" title="var">ds</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">tid_in_walk</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span>,<br/>  <span class="id" title="var">Graph.In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> -&gt;<br/>  <span class="id" title="tactic">exists</span> <span class="id" title="var">p</span>,<br/>  <span class="id" title="var">Map_TID.MapsTo</span> <span class="id" title="var">t</span> <span class="id" title="var">p</span> (<span class="id" title="var">get_tasks</span> <span class="id" title="var">s</span>) /\<br/>  <span class="id" title="var">Map_TID.MapsTo</span> <span class="id" title="var">t</span> <span class="id" title="var">p</span> <span class="id" title="var">deadlocked_tasks</span>.<br/><span class="id" title="keyword">Let</span> <span class="id" title="var">task_in_left</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>,<br/>  <span class="id" title="var">List.In</span> (<span class="id" title="var">t1</span>, <span class="id" title="var">t2</span>) <span class="id" title="var">w</span> -&gt;<br/>  <span class="id" title="var">Graph.In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t1</span>.<br/><span class="id" title="keyword">Let</span> <span class="id" title="var">task_in_right</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>,<br/>  <span class="id" title="var">List.In</span> (<span class="id" title="var">t1</span>, <span class="id" title="var">t2</span>) <span class="id" title="var">w</span> -&gt;<br/>  <span class="id" title="var">Graph.In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t2</span>.<br/></pre>
<p>Given that any task <span class="inlinecode"><span class="id" title="var">t</span></span> that is in <span class="inlinecode"><span class="id" title="var">w</span></span> is in <span class="inlinecode"><span class="id" title="var">deadlocked_tasks</span></span> and in <span class="inlinecode"><span class="id" title="var">get_tasks</span></span>  <span class="inlinecode"><span class="id" title="var">s</span></span> ,
  thus, applying the definition of <span class="inlinecode"><span class="id" title="var">WaitOn</span></span> we get that <span class="inlinecode"><span class="id" title="var">t</span></span> is also blocked in <span class="inlinecode"><span class="id" title="var">ds</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">blocked_conv</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">t</span> <span class="id" title="var">e</span>,<br/>  <span class="id" title="var">Graph.In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> -&gt;<br/>  <span class="id" title="var">WaitOn</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">e</span> -&gt;<br/>  <span class="id" title="var">WaitOn</span> <span class="id" title="var">ds</span> <span class="id" title="var">t</span> <span class="id" title="var">e</span>.<br/></pre>
<p>It is trivial to observe that if task <span class="inlinecode"><span class="id" title="var">t</span></span> is registered in <span class="inlinecode"><span class="id" title="var">s</span></span> ,
  then task <span class="inlinecode"><span class="id" title="var">t</span></span> is also registered in <span class="inlinecode"><span class="id" title="var">ds</span></span> , by using lemma <span class="inlinecode"><span class="id" title="var">blocked_conv</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">registered_conv</span>:<br/>  <span class="id" title="keyword">forall</span> (<span class="id" title="var">t</span>:<span class="id" title="var">tid</span>) <span class="id" title="var">e</span>,<br/>  <span class="id" title="var">Graph.In</span> (<span class="id" title="var">F.Edge</span> <span class="id" title="var">w</span>) <span class="id" title="var">t</span> -&gt;<br/>  <span class="id" title="var">Registered</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span> <span class="id" title="var">e</span> -&gt;<br/>  <span class="id" title="var">Registered</span> <span class="id" title="var">ds</span> <span class="id" title="var">t</span> <span class="id" title="var">e</span>.<br/></pre>
<p>Showing that an impeded_by relation is preserved in <span class="inlinecode"><span class="id" title="var">ds</span></span> ,
  follows from lemmas <span class="inlinecode"><span class="id" title="var">registered_conv</span></span> and <span class="inlinecode"><span class="id" title="var">blocked_conv</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">impeded_by_conv</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">e</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>,<br/>  <span class="id" title="var">List.In</span> (<span class="id" title="var">t1</span>, <span class="id" title="var">t2</span>) <span class="id" title="var">w</span> -&gt;<br/>  <span class="id" title="var">WaitOn</span> <span class="id" title="var">s</span> <span class="id" title="var">t1</span> <span class="id" title="var">e</span> -&gt;<br/>  <span class="id" title="var">ImpededBy</span> <span class="id" title="var">s</span> <span class="id" title="var">e</span> <span class="id" title="var">t2</span> -&gt;<br/>  <span class="id" title="var">ImpededBy</span> <span class="id" title="var">ds</span> <span class="id" title="var">e</span> <span class="id" title="var">t2</span>.<br/></pre>
<p>We conclude (ii) by establishing that any edge <span class="inlinecode"><span class="id" title="var">e</span></span> in the WFG of <span class="inlinecode"><span class="id" title="var">s</span></span> and
  in walk <span class="inlinecode"><span class="id" title="var">w</span></span> is also in the WFG of <span class="inlinecode"><span class="id" title="var">ds</span></span> , from lemmas <span class="inlinecode"><span class="id" title="var">blocked_conv</span></span> and <span class="inlinecode"><span class="id" title="var">impeded_by_conv</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">t_edge_conv</span>:<br/>  <span class="id" title="keyword">forall</span> <span class="id" title="var">e</span>,<br/>  <span class="id" title="var">List.In</span> <span class="id" title="var">e</span> <span class="id" title="var">w</span> -&gt;<br/>  <span class="id" title="var">TEdge</span> <span class="id" title="var">s</span> <span class="id" title="var">e</span> -&gt;<br/>  <span class="id" title="var">TEdge</span> <span class="id" title="var">ds</span> <span class="id" title="var">e</span>.<br/></pre>
<p>Thus, from lemma <span class="inlinecode"><span class="id" title="var">t_edge_conv</span></span> , we get (i) <span class="inlinecode"><span class="id" title="var">w</span></span> is a cycle on the WFG of <span class="inlinecode"><span class="id" title="var">ds</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">cycle_conv</span>:<br/>  <span class="id" title="var">TCycle</span> <span class="id" title="var">ds</span> <span class="id" title="var">w</span>.<br/></pre>
<p>We conclude the main result of this section by applying Theorem <span class="inlinecode"><span class="id" title="var">soundness_totally</span></span> to Lemma <span class="inlinecode"><span class="id" title="var">cycle_conv</span></span> and Lemma <span class="inlinecode"><span class="id" title="var">vertex_in_tasks</span></span> .</p>
<pre class="code"><span class="id" title="keyword">Let</span> <span class="id" title="var">ds_totally_deadlocked</span> :=<br/>  <span class="id" title="var">soundness_totally</span> <span class="id" title="var">ds</span> <span class="id" title="var">w</span> <span class="id" title="var">cycle_conv</span> <span class="id" title="var">vertex_in_tasks</span>.<br/><span class="id" title="keyword">Theorem</span> <span class="id" title="var">soundness</span>:<br/>  <span class="id" title="var">Deadlocked</span> <span class="id" title="var">s</span>.<br/><span class="id" title="keyword">End</span> <span class="id" title="var">Soundness</span>.<br/></pre>
